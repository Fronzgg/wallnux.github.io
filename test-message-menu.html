<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –º–µ–Ω—é —Å–æ–æ–±—â–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="message-menu.css">
    <style>
        body {
            background: #36393f;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #2f3136;
            border-radius: 8px;
            padding: 20px;
        }
        .test-info {
            background: #202225;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: #dcddde;
        }
        .test-info h2 {
            margin-top: 0;
            color: #fff;
        }
        .test-info code {
            background: #40444b;
            padding: 2px 6px;
            border-radius: 3px;
            color: #00b0f4;
        }
        #messagesContainer {
            min-height: 300px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">
            <h2>üß™ –¢–µ—Å—Ç –º–µ–Ω—é —Å–æ–æ–±—â–µ–Ω–∏–π</h2>
            <p><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong></p>
            <ul>
                <li>–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ —Å 3 —Ç–æ—á–∫–∞–º–∏</li>
                <li>–ù–∞–∂–º–∏—Ç–µ –ü–ö–ú –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–∏ ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –º–µ–Ω—é</li>
                <li>–î–ª—è <strong>—Å–≤–æ–∏—Ö</strong> —Å–æ–æ–±—â–µ–Ω–∏–π –±—É–¥—É—Ç –∫–Ω–æ–ø–∫–∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –∏ "–£–¥–∞–ª–∏—Ç—å"</li>
                <li>–î–ª—è <strong>—á—É–∂–∏—Ö</strong> —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ "–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é"</li>
            </ul>
            <p><strong>–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <code id="currentUserId">1</code></p>
        </div>

        <div id="messagesContainer"></div>
    </div>

    <script>
        // –≠–º—É–ª—è—Ü–∏—è currentUser
        window.currentUser = {
            id: 1,
            username: 'TestUser',
            avatar: 'T'
        };

        // –ü–æ–∫–∞–∑–∞—Ç—å ID –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        document.getElementById('currentUserId').textContent = window.currentUser.id;

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å message-menu.js
        const script = document.createElement('script');
        script.src = 'message-menu.js';
        document.head.appendChild(script);

        // –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        setTimeout(() => {
            createTestMessages();
        }, 500);

        function createTestMessages() {
            const container = document.getElementById('messagesContainer');
            
            // –°–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (userId = 1)
            const ownMessage = createMessageElement({
                id: 1,
                userId: 1,
                author: 'TestUser',
                avatar: 'T',
                text: '–≠—Ç–æ –º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (userId: 1) - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –∫–Ω–æ–ø–∫–∏',
                timestamp: new Date()
            });
            container.appendChild(ownMessage);

            // –ß—É–∂–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (userId = 2)
            const otherMessage = createMessageElement({
                id: 2,
                userId: 2,
                author: 'OtherUser',
                avatar: 'O',
                text: '–≠—Ç–æ —á—É–∂–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (userId: 2) - —Ç–æ–ª—å–∫–æ —Ä–µ–∞–∫—Ü–∏—è',
                timestamp: new Date()
            });
            container.appendChild(otherMessage);

            // –ï—â–µ –æ–¥–Ω–æ —Å–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const ownMessage2 = createMessageElement({
                id: 3,
                userId: 1,
                author: 'TestUser',
                avatar: 'T',
                text: '–ï—â–µ –æ–¥–Ω–æ –º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –∫–Ω–æ–ø–∫–∏',
                timestamp: new Date()
            });
            container.appendChild(ownMessage2);
        }

        function createMessageElement(messageData) {
            const messageGroup = document.createElement('div');
            messageGroup.className = 'message-group message';
            messageGroup.setAttribute('data-message-id', messageData.id);
            messageGroup.setAttribute('data-user-id', messageData.userId);
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = messageData.avatar;
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const header = document.createElement('div');
            header.className = 'message-header';
            
            const author = document.createElement('span');
            author.className = 'message-author';
            author.textContent = messageData.author;
            
            const timestamp = document.createElement('span');
            timestamp.className = 'message-timestamp';
            timestamp.textContent = '–°–µ–π—á–∞—Å';
            
            header.appendChild(author);
            header.appendChild(timestamp);
            
            const text = document.createElement('div');
            text.className = 'message-text';
            text.textContent = messageData.text;
            
            content.appendChild(header);
            content.appendChild(text);
            
            // –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –º–µ–Ω—é
            if (typeof window.addMessageMenu === 'function') {
                const menuBtn = window.addMessageMenu(messageGroup, messageData);
                content.appendChild(menuBtn);
            }
            
            // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ü–ö–ú
            messageGroup.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                if (typeof window.showMessageContextMenu === 'function') {
                    window.showMessageContextMenu(e, messageData);
                }
            });
            
            messageGroup.appendChild(avatar);
            messageGroup.appendChild(content);
            
            return messageGroup;
        }
    </script>
</body>
</html>
